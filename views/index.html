<html>
  <head>
    <meta charset="utf-8">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- jQuery -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.min.js"></script>

    <script src="../static/js/ui-bootstrap-tpls-0.13.0.min.js"></script>

    <style>
      body {
        padding-top: 50px;
      }

      .dummy-sm {
        height: 10px;
      }

      .dummy-lg {
        height: 40px;
      }

      .clickable-row:hover {
        cursor: pointer;
      }
    </style>

    <script>
      angular.element(document).ready(function() {
        angular.bootstrap(document, ['readings']);
      });

      var app = angular.module('readings', ['ui.bootstrap']);

      app.config(function($httpProvider) {
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
      });

      app.controller('list', function($scope, $http, $window, $sce) {
        $http.get('../data/index.json')
        .success(function(data) {
          $scope.data = data;
        });

        $scope.open_index = function() {
          $http.get('../data/index.json')
          .success(function(data) {
            $scope.data = data;
          });
        };

        $scope.open_document = function(doc) {
          if (doc.document_type == 'list') {
            $http.get(doc.url)
            .success(function(data) {
              $scope.data = data;
            });
          } else if (doc.document_type == 'image') {
            $scope.data = doc;
          } else if (doc.document_type == 'youtube') {
            doc.trust_embed_url = $sce.trustAsResourceUrl(doc.embed_url);
            $scope.data = doc;
          } else {
            $window.location.href = doc.url;
          }
        };
      });
    </script>
  </head>

  <body ng-controller="list">
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" ng-click="open_index()">
            <strong>HOME</strong>
          </a>
        </div>
        <ul class="nav navbar-nav navbar-right">
        </ul>
      </div><!-- /.container-fluid -->
    </nav>

    <div class="container">
      <div>
        <div class="row">
          <div class="page-header">
            <h2 class="pull-left">{{ data.title }}</h2>
            <div class="clearfix"></div>
          </div>
        </div>
        <div class="row">
          <table ng-if="data.document_type == 'index'" class="table table-striped">
            <thead>
              <tr>
                <th class="col-lg-10">Title</th>
                <th class="col-lg-2">Count</th>
              </tr>
            </thead>
            <tbody>
              <tr class="clickable-row" ng-repeat="doc in data.documents" ng-click="open_document(doc)">
                <td>{{ doc.title }}</td>
                <td>{{ doc.count }}</td>
              </tr>
            </tbody>
          </table>

          <table ng-if="data.document_type == 'list'" class="table table-striped">
            <thead>
              <tr>
                <th class="col-lg-10">Title</th>
                <th class="col-lg-2">State</th>
              </tr>
            </thead>
            <tbody>
              <tr class="clickable-row" ng-repeat="doc in data.documents" ng-click="open_document(doc)">
                <td>{{ doc.title }}</td>
                <td>{{ doc.state }}</td>
              </tr>
            </tbody>
          </table>

          <div ng-if="data.document_type == 'image'" class="col-lg-12">
            <img ng-src="{{ data.url }}" class="img-responsive"/>
          </div>

          <div ng-if="data.document_type == 'youtube'" class="col-lg-12">
            <div class="embed-responsive embed-responsive-16by9">
              <iframe class="embed-responsive-item" ng-src="{{ data.trust_embed_url }}" allowfullscreen></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
